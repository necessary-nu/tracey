/* ==========================================================================
   Tracey Dashboard Styles
   Modern CSS with native nesting and cascade layers
   ========================================================================== */

/* Define cascade layer order - layers listed first have lowest priority */
@layer reset, tokens, base, utilities, components;

/* ==========================================================================
   TOKENS LAYER
   CSS custom properties and design tokens
   ========================================================================== */

@layer tokens {
    :root {
        color-scheme: light dark;

        /* ==========================================================================
       Background Colors
       ========================================================================== */
        --bg-outer: light-dark(#e5e7eb, #0f1117);
        --bg: light-dark(#f8f9fa, #141822);
        --bg-secondary: light-dark(#ffffff, #1a2030);
        --bg-sidebar: light-dark(#f3f4f6, #12161e);

        /* ==========================================================================
       Text Colors (hierarchy: heading ~90%, body ~80%, muted ~65%, dim ~55%)
       ========================================================================== */
        --fg-heading: light-dark(#111827, #e8ecf4);
        --fg: light-dark(#1a1b26, #d0d4da);
        --fg-muted: light-dark(#4b5563, #9ba3b0);
        --fg-dim: light-dark(#6b7280, #6b7585);

        /* ==========================================================================
       Border Colors
       ========================================================================== */
        --border: light-dark(#e5e5e5, rgba(255, 255, 255, 0.08));
        --border-strong: light-dark(#d1d5db, rgba(255, 255, 255, 0.15));

        /* ==========================================================================
       Interactive State Colors
       ========================================================================== */
        --hover: light-dark(#f0f0f2, #1f2335);
        --hover-subtle: light-dark(#f8f8fa, #1a1f2e);

        /* ==========================================================================
       Semantic Base Colors
       ========================================================================== */
        --accent: var(--arb-at);
        --green: var(--arb-da);
        --red: var(--arb-dd);
        --yellow: var(--arb-n);
        --purple: var(--arb-s);
        --blue: var(--arb-tu);
        --neutral: light-dark(#6b7ba8, #8b9bc8);

        /* ==========================================================================
       Color Opacity Scale
       Standardized percentages: 5, 10, 12, 15, 20, 25, 30, 40, 50
       Usage: backgrounds, borders, highlights at various intensities
       ========================================================================== */

        /* Accent scale */
        --accent-5: color-mix(in srgb, var(--accent) 5%, var(--bg));
        --accent-10: color-mix(in srgb, var(--accent) 10%, var(--bg));
        --accent-12: color-mix(in srgb, var(--accent) 12%, var(--bg));
        --accent-15: color-mix(in srgb, var(--accent) 15%, var(--bg));
        --accent-20: color-mix(in srgb, var(--accent) 20%, var(--bg));
        --accent-30: color-mix(in srgb, var(--accent) 30%, var(--bg));

        /* Green scale */
        --green-15: color-mix(in srgb, var(--green) 15%, var(--bg));
        --green-20: color-mix(in srgb, var(--green) 20%, var(--bg));
        --green-30: color-mix(in srgb, var(--green) 30%, var(--bg));
        --green-40: color-mix(in srgb, var(--green) 40%, var(--bg));

        /* Yellow scale */
        --yellow-20: color-mix(in srgb, var(--yellow) 20%, var(--bg));
        --yellow-40: color-mix(in srgb, var(--yellow) 40%, var(--bg));
        --yellow-50: color-mix(in srgb, var(--yellow) 50%, var(--bg));

        /* Red scale */
        --red-20: color-mix(in srgb, var(--red) 20%, var(--bg));
        --red-30: color-mix(in srgb, var(--red) 30%, var(--bg));

        /* Neutral scale */
        --neutral-25: color-mix(in srgb, var(--neutral) 25%, var(--bg));
        --neutral-40: color-mix(in srgb, var(--neutral) 40%, var(--bg));

        /* Foreground scale (for code backgrounds, subtle buttons) */
        --fg-8: color-mix(in srgb, var(--fg-dim) 8%, var(--bg));
        --fg-15: color-mix(in srgb, var(--fg) 15%, var(--bg));
        --fg-20: color-mix(in srgb, var(--fg-dim) 20%, var(--bg));

        /* Background secondary scale (for code blocks) */
        --bg-secondary-95: color-mix(in srgb, var(--bg-secondary) 95%, var(--bg));

        /* ==========================================================================
       Semantic Color Aliases (use these in components)
       ========================================================================== */

        /* Dim variants - for subtle backgrounds */
        --accent-dim: var(--accent-20);
        --green-dim: var(--green-20);
        --yellow-dim: var(--yellow-20);
        --red-dim: var(--red-20);
        --neutral-dim: var(--neutral-25);

        /* Highlight backgrounds - for selection, focus states */
        --highlight-accent: var(--accent-15);
        --highlight-impl: var(--green-15);
        --highlight-verify: var(--accent-15);
        --highlight-search: var(--yellow-20);
        --highlight-target: var(--accent-10);

        /* Focus ring */
        --focus-ring: var(--accent-20);

        /* Flash feedback */
        --flash-success: var(--green-30);

        /* ==========================================================================
       Status Colors (coverage states)
       ========================================================================== */
        --status-covered-bg: var(--green-15);
        --status-covered-fg: var(--fg);
        --status-partial-bg: var(--yellow-dim);
        --status-partial-fg: var(--fg);
        --status-uncovered-bg: var(--accent);
        --status-uncovered-fg: light-dark(white, #111827);
        --status-none-bg: var(--neutral-dim);
        --status-none-fg: var(--fg);

        /* ==========================================================================
       Reference Type Colors
       ========================================================================== */
        --ref-impl-color: var(--green);
        --ref-impl-bg: var(--green-15);
        --ref-impl-border: var(--green-30);

        --ref-verify-color: var(--accent);
        --ref-verify-bg: var(--accent-15);
        --ref-verify-border: var(--accent-30);

        /* ==========================================================================
       Rule Block Border Colors
       ========================================================================== */
        --rule-covered-border: var(--green-40);
        --rule-partial-border: var(--yellow-40);
        --rule-uncovered-border: var(--neutral-40);

        /* ==========================================================================
       Layout
       ========================================================================== */
        --max-width: 1600px;

        /* Fonts */
        --font-sans: "Recursive", system-ui, -apple-system, sans-serif;
        --font-mono: "Recursive", monospace;

        /* ==========================================================================
       Typography Scale
       Based on a modular scale with base 1rem (16px)
       ========================================================================== */

        /* Font Sizes */
        --text-2xs: 0.625rem; /* 10px - tiny badges */
        --text-xs: 0.75rem; /* 12px - labels, captions */
        --text-sm: 0.875rem; /* 14px - UI text, secondary */
        --text-base: 1rem; /* 16px - body text */
        --text-lg: 1.125rem; /* 18px - lead text */
        --text-xl: 1.25rem; /* 20px - h4, stat values */
        --text-2xl: 1.5rem; /* 24px - h3, titles */
        --text-3xl: 1.875rem; /* 30px - h2 */
        --text-4xl: 2.25rem; /* 36px - h1 */

        /* Line Heights */
        --leading-none: 1;
        --leading-tight: 1.25;
        --leading-snug: 1.4;
        --leading-normal: 1.5;
        --leading-relaxed: 1.6;
        --leading-loose: 1.75;

        /* Font Weights */
        --weight-normal: 400;
        --weight-medium: 500;
        --weight-semibold: 600;
        --weight-bold: 700;
        --weight-extrabold: 800;
        --weight-black: 900;

        /* Letter Spacing */
        --tracking-tight: -0.025em;
        --tracking-normal: 0;
        --tracking-wide: 0.02em;
        --tracking-wider: 0.04em;
        --tracking-widest: 0.05em;

        /* ==========================================================================
       Semantic Typography Tokens
       Use these in components for consistent text styling
       ========================================================================== */

        /* Headings */
        --heading-1-size: var(--text-2xl);
        --heading-1-weight: var(--weight-black);
        --heading-2-size: var(--text-xl);
        --heading-2-weight: var(--weight-extrabold);
        --heading-3-size: var(--text-lg);
        --heading-3-weight: var(--weight-extrabold);
        --heading-4-size: var(--text-base);
        --heading-4-weight: var(--weight-bold);

        /* Body text */
        --body-size: var(--text-sm);
        --body-weight: var(--weight-normal);
        --body-leading: var(--leading-relaxed);

        /* UI text (buttons, nav, controls) */
        --ui-size: var(--text-sm);
        --ui-weight: var(--weight-medium);

        /* Labels (uppercase captions) */
        --label-size: var(--text-xs);
        --label-weight: var(--weight-medium);
        --label-tracking: var(--tracking-widest);

        /* Small/caption text */
        --caption-size: var(--text-xs);
        --caption-weight: var(--weight-normal);

        /* Code text */
        --code-size: var(--text-sm);
        --code-inline-size: 0.85em;

        /* ==========================================================================
       Spacing Scale
       Based on 4px (0.25rem) base unit
       ========================================================================== */

        /* Core spacing scale */
        --space-0: 0;
        --space-px: 1px;
        --space-0-5: 0.125rem; /* 2px */
        --space-1: 0.25rem; /* 4px */
        --space-1-5: 0.375rem; /* 6px */
        --space-2: 0.5rem; /* 8px */
        --space-2-5: 0.625rem; /* 10px */
        --space-3: 0.75rem; /* 12px */
        --space-3-5: 0.875rem; /* 14px */
        --space-4: 1rem; /* 16px */
        --space-5: 1.25rem; /* 20px */
        --space-6: 1.5rem; /* 24px */
        --space-8: 2rem; /* 32px */
        --space-10: 2.5rem; /* 40px */
        --space-12: 3rem; /* 48px */

        /* Semantic spacing aliases */
        --gap-xs: var(--space-1);
        --gap-sm: var(--space-2);
        --gap-md: var(--space-3);
        --gap-lg: var(--space-4);
        --gap-xl: var(--space-6);

        /* ==========================================================================
       Animation & Transition Timing
       ========================================================================== */

        /* Duration scale */
        --duration-instant: 0.1s;
        --duration-fast: 0.15s;
        --duration-normal: 0.25s;
        --duration-slow: 0.4s;
        --duration-emphasis: 3s;

        /* Easing functions */
        --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
        --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);
        --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);

        /* Arborium syntax highlighting colors (combined light/dark) */
        --arb-at: light-dark(var(--arb-at-light), var(--arb-at-dark));
        --arb-co: light-dark(var(--arb-co-light), var(--arb-co-dark));
        --arb-fb: light-dark(var(--arb-fb-light), var(--arb-fb-dark));
        --arb-f: light-dark(var(--arb-f-light), var(--arb-f-dark));
        --arb-k: light-dark(var(--arb-k-light), var(--arb-k-dark));
        --arb-o: light-dark(var(--arb-o-light), var(--arb-o-dark));
        --arb-pr: light-dark(var(--arb-pr-light), var(--arb-pr-dark));
        --arb-p: light-dark(var(--arb-p-light), var(--arb-p-dark));
        --arb-s: light-dark(var(--arb-s-light), var(--arb-s-dark));
        --arb-tg: light-dark(var(--arb-tg-light), var(--arb-tg-dark));
        --arb-err: light-dark(var(--arb-err-light), var(--arb-err-dark));
        --arb-t: light-dark(var(--arb-t-light), var(--arb-t-dark));
        --arb-v: light-dark(var(--arb-v-light), var(--arb-v-dark));
        --arb-c: light-dark(var(--arb-c-light), var(--arb-c-dark));
        --arb-m: light-dark(var(--arb-m-light), var(--arb-m-dark));
        --arb-l: light-dark(var(--arb-l-light), var(--arb-l-dark));
        --arb-da: light-dark(var(--arb-da-light), var(--arb-da-dark));
        --arb-dd: light-dark(var(--arb-dd-light), var(--arb-dd-dark));
        --arb-n: light-dark(var(--arb-n-light), var(--arb-n-dark));
        --arb-tl: light-dark(var(--arb-tl-light), var(--arb-tl-dark));
        --arb-tu: light-dark(var(--arb-tu-light), var(--arb-tu-dark));
        --arb-tr: light-dark(var(--arb-tr-light), var(--arb-tr-dark));
        --arb-se: light-dark(var(--arb-se-light), var(--arb-se-dark));
        --arb-tt: light-dark(var(--arb-tt-light), var(--arb-tt-dark));
        --arb-ch: light-dark(var(--arb-ch-light), var(--arb-ch-dark));
        --arb-sr: light-dark(var(--arb-sr-light), var(--arb-sr-dark));
        --arb-bo: light-dark(var(--arb-bo-light), var(--arb-bo-dark));
    }
} /* end @layer tokens */

/* ==========================================================================
   RESET & BASE LAYER
   Element defaults and resets
   ========================================================================== */

@layer reset {
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
} /* end @layer reset */

@layer base {
    body {
        font-family: var(--font-sans);
        background: var(--bg-outer);
        color: var(--fg);
        line-height: var(--leading-relaxed);
    }

    /* Monospace text using Recursive's MONO axis */
    :is(.mono, code, pre) {
        font-family: var(--font-mono);
        font-variation-settings:
            "MONO" 1,
            "CASL" 0;
    }
} /* end @layer base */

/* ==========================================================================
   UTILITIES LAYER
   Reusable single-purpose classes for layout and common patterns.
   Use sparingly in CSS, more freely in markup for quick adjustments.
   ========================================================================== */

@layer utilities {
    /* Layout */
    .flex {
        display: flex;
    }
    .flex-col {
        display: flex;
        flex-direction: column;
    }
    .flex-1 {
        flex: 1;
    }
    .flex-shrink-0 {
        flex-shrink: 0;
    }
    .inline-flex {
        display: inline-flex;
    }

    /* Alignment */
    .items-center {
        align-items: center;
    }
    .items-start {
        align-items: flex-start;
    }
    .items-stretch {
        align-items: stretch;
    }
    .justify-center {
        justify-content: center;
    }
    .justify-between {
        justify-content: space-between;
    }
    .justify-end {
        justify-content: flex-end;
    }

    /* Gap utilities (using spacing scale) */
    .gap-0 {
        gap: var(--space-0);
    }
    .gap-1 {
        gap: var(--space-1);
    }
    .gap-2 {
        gap: var(--space-2);
    }
    .gap-3 {
        gap: var(--space-3);
    }
    .gap-4 {
        gap: var(--space-4);
    }
    .gap-6 {
        gap: var(--space-6);
    }
    .gap-8 {
        gap: var(--space-8);
    }

    /* Text utilities */
    .text-2xs {
        font-size: var(--text-2xs);
    }
    .text-xs {
        font-size: var(--text-xs);
    }
    .text-sm {
        font-size: var(--text-sm);
    }
    .text-base {
        font-size: var(--text-base);
    }
    .text-lg {
        font-size: var(--text-lg);
    }
    .text-xl {
        font-size: var(--text-xl);
    }

    .font-normal {
        font-weight: var(--weight-normal);
    }
    .font-medium {
        font-weight: var(--weight-medium);
    }
    .font-semibold {
        font-weight: var(--weight-semibold);
    }
    .font-bold {
        font-weight: var(--weight-bold);
    }

    .text-muted {
        color: var(--fg-muted);
    }
    .text-dim {
        color: var(--fg-dim);
    }
    .text-accent {
        color: var(--accent);
    }

    /* Visual utilities */
    .rounded-sm {
        border-radius: 3px;
    }
    .rounded {
        border-radius: 4px;
    }
    .rounded-md {
        border-radius: 6px;
    }
    .rounded-lg {
        border-radius: 8px;
    }
    .rounded-full {
        border-radius: 9999px;
    }

    .overflow-hidden {
        overflow: hidden;
    }
    .overflow-auto {
        overflow: auto;
    }

    .truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* Interactive utilities */
    .clickable {
        cursor: pointer;
        transition: background 0.15s;

        &:hover {
            background: var(--hover);
        }
    }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
} /* end @layer utilities */

/* ==========================================================================
   COMPONENTS LAYER
   All component styles
   ========================================================================== */

@layer components {
    /* ==========================================================================
   ANIMATIONS & KEYFRAMES
   Reusable animation definitions
   ========================================================================== */

    /* Attention-grabbing pulse for highlights */
    @keyframes pulse-attention {
        0%,
        20% {
            box-shadow: 0 0 0 4px var(--pulse-color, var(--accent));
            transform: scale(var(--pulse-scale, 1.05));
        }
        100% {
            box-shadow: 0 0 0 0 transparent;
            transform: scale(1);
        }
    }

    /* Flash for success feedback */
    @keyframes flash-success {
        0% {
            background: var(--flash-success);
        }
        100% {
            background: transparent;
        }
    }

    /* Pop-in for appearing elements */
    @keyframes pop-in {
        from {
            transform: scale(0.8);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }

    /* Fade in */
    @keyframes fade-in {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    /* Respect user preferences for reduced motion */
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }

    /* ==========================================================================
   App Shell
   ========================================================================== */

    #app {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        color: var(--fg-muted);
        font-size: var(--text-sm);
    }

    /* ==========================================================================
   Buttons
   ========================================================================== */

    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        font-family: var(--font-sans);
        font-size: var(--ui-size);
        font-weight: var(--ui-weight);
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition:
            background 0.15s,
            opacity 0.15s;

        &-md {
            padding: var(--space-2) var(--space-4);
        }

        &-sm {
            padding: var(--space-1-5) var(--space-3);
            font-size: var(--text-xs);
        }

        &-primary {
            background: var(--accent);
            color: white;

            &:hover {
                opacity: 0.9;
            }
        }

        &-secondary {
            background: var(--bg-secondary);
            color: var(--fg);
            border: 1px solid var(--border);

            &:hover {
                background: var(--hover);
            }
        }

        &-ghost {
            background: transparent;
            color: var(--fg-muted);

            &:hover {
                background: var(--hover-subtle);
                color: var(--fg);
            }
        }
    }

    /* ==========================================================================
   Layout
   ========================================================================== */

    .layout {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: var(--max-width);
        max-width: 100%;
        margin: 0 auto;
        background: var(--bg);
        border-inline-start: 1px solid var(--border);
        border-inline-end: 1px solid var(--border);
    }

    .main {
        flex: 1;
        display: flex;
        overflow: hidden;
        width: 100%;
    }

    /* ==========================================================================
   Header
   ========================================================================== */

    .header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        position: relative;
        z-index: 100;

        &-inner {
            display: flex;
            align-items: stretch;
            width: 100%;
            margin-bottom: -1px;
        }

        &-pickers {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: 0 var(--space-4);
            border-inline-end: 1px solid var(--border);
        }

        &-select {
            padding: var(--space-1-5) var(--space-2-5);
            background: var(--bg);
            color: var(--fg);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: var(--text-sm);
            font-family: inherit;
            cursor: pointer;
            min-width: 80px;

            &:hover {
                border-color: var(--fg-muted);
            }

            &:focus {
                outline: none;
                border-color: var(--accent);
            }
        }

        &-controls {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-inline-start: auto;
        }
    }

    .spec-source-link {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-1);
        color: var(--fg-dim);
        opacity: 0.6;
        transition:
            opacity 0.15s,
            color 0.15s;

        &:hover {
            opacity: 1;
            color: var(--accent);
        }

        & svg {
            width: 14px;
            height: 14px;
        }
    }

    .logo {
        font-weight: var(--weight-semibold);
        font-size: var(--text-lg);
        color: var(--fg);
        text-decoration: none;
        display: flex;
        align-items: center;
        padding: var(--space-3) var(--space-5);
        margin-inline-start: auto;

        &:hover {
            background: var(--hover-subtle);
        }
    }

    /* ==========================================================================
   Navigation
   ========================================================================== */

    .nav {
        display: flex;

        &-tab {
            padding: var(--space-3) var(--space-5);
            background: transparent;
            color: var(--fg-muted);
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: var(--text-sm);
            font-family: inherit;
            transition: all 0.15s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--space-1-5);

            &:hover {
                background: var(--hover-subtle);
                color: var(--fg);
            }

            &.active {
                color: var(--accent);
                border-bottom: 2px solid var(--accent);
                background: var(--bg);
            }

            & .tab-icon {
                display: flex;

                & svg {
                    width: 1em;
                    height: 1em;
                    stroke-width: 1.5;
                }
            }
        }
    }

    /* ==========================================================================
   Search Box (in header)
   ========================================================================== */

    .search-box {
        flex: 1;
        max-width: 400px;
        margin-inline-start: auto;
    }

    .search-input {
        width: 100%;
        padding: var(--space-2) var(--space-3);
        background: var(--bg);
        color: var(--fg);
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: var(--text-sm);
        font-family: inherit;

        &:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }

        &::placeholder {
            color: var(--fg-dim);
        }
    }

    /* ==========================================================================
   Stats Bar
   ========================================================================== */

    .stats-bar {
        display: flex;
        align-items: center;
        gap: var(--space-8);
        padding: var(--space-4) var(--space-6);
        border-bottom: 1px solid var(--border);
        background: var(--bg-secondary);
        width: 100%;
        position: relative;
        z-index: 50;
    }

    .stat {
        display: flex;
        flex-direction: column;
        gap: var(--space-0-5);

        &-label {
            font-size: var(--label-size);
            color: var(--fg-muted);
            text-transform: uppercase;
            letter-spacing: var(--label-tracking);
        }

        &-value {
            font-size: var(--text-xl);
            font-weight: var(--weight-semibold);

            &.good {
                color: var(--green);
            }
            &.warn {
                color: var(--yellow);
            }
            &.bad {
                color: var(--red);
            }
        }

        &.clickable {
            cursor: pointer;
            padding: var(--space-2);
            margin: calc(-1 * var(--space-2));
            border-radius: 6px;
            transition: background 0.15s;

            &:hover {
                background: var(--hover);
            }
        }
    }

    .stats-controls {
        display: flex;
        gap: var(--space-3);
        margin-inline-start: auto;
    }

    /* ==========================================================================
   Sidebar
   ========================================================================== */

    .sidebar {
        width: 360px;
        border-inline-end: 1px solid var(--border);
        background: var(--bg-sidebar);
        display: flex;
        flex-direction: column;
        overflow: hidden;

        &-header {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--border);
            font-weight: var(--ui-weight);
            font-size: var(--text-sm);
            color: var(--fg-muted);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        &-content {
            flex: 1;
            overflow-y: auto;
        }
    }

    /* ==========================================================================
   File Tree
   ========================================================================== */

    .file-tree {
        padding: var(--space-2);
    }

    .tree-folder {
        user-select: none;

        &-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-1);
            padding: var(--space-1-5) var(--space-2);
            border-radius: 4px;
            cursor: pointer;
            font-size: var(--text-sm);
            color: var(--fg);

            &:hover {
                background: var(--hover);
            }
        }

        &-left {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        &-icon {
            width: 1rem;
            height: 1rem;
            color: var(--fg-dim);
            transition: transform 0.15s;
        }

        &-children {
            display: none;
            padding-inline-start: var(--space-4);
        }

        &.open {
            & > .tree-folder-header .tree-folder-icon {
                transform: rotate(90deg);
            }

            & > .tree-folder-children {
                display: block;
            }
        }
    }

    .folder-badge {
        font-size: var(--text-2xs);
        padding: var(--space-0-5) var(--space-1-5);
        border-radius: 4px;
        font-weight: var(--ui-weight);

        &.full {
            background: var(--status-covered-bg);
            color: var(--status-covered-fg);
        }

        &.partial {
            background: var(--status-partial-bg);
            color: var(--status-partial-fg);
        }

        &.none {
            background: var(--status-none-bg);
            color: var(--status-none-fg);
        }
    }

    .tree-file {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-1-5) var(--space-2);
        padding-inline-start: var(--space-2);
        border-radius: 4px;
        cursor: pointer;
        font-size: var(--text-sm);

        &:hover {
            background: var(--hover);
        }

        &.selected {
            background: var(--accent-dim);
            color: var(--accent);
        }

        &-icon {
            width: 1rem;
            height: 1rem;
            flex-shrink: 0;
            opacity: 0.8;
        }

        &-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        &-badge {
            flex-shrink: 0;
            font-size: var(--text-2xs);
            padding: var(--space-0-5) var(--space-1-5);
            border-radius: 4px;
            font-weight: var(--ui-weight);

            &.full {
                background: var(--status-covered-bg);
                color: var(--status-covered-fg);
            }

            &.partial {
                background: var(--status-partial-bg);
                color: var(--status-partial-fg);
            }

            &.none {
                background: var(--status-none-bg);
                color: var(--status-none-fg);
            }
        }
    }

    /* ==========================================================================
   Content Area
   ========================================================================== */

    .content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background: var(--bg);

        &-header {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-2) var(--space-4);
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            font-size: var(--text-sm);
        }

        &-body {
            flex: 1;
            overflow: auto;
        }
    }

    /* ==========================================================================
   Spec Switcher
   ========================================================================== */

    .spec-switcher {
        display: flex;
        gap: var(--space-1);
    }

    .spec-tab {
        padding: var(--space-1-5) var(--space-3);
        border: none;
        background: transparent;
        color: var(--fg-muted);
        cursor: pointer;
        border-radius: 4px;
        font-family: inherit;
        font-size: inherit;
        transition:
            background-color 0.15s,
            color 0.15s;

        &:hover {
            background: var(--hover);
            color: var(--fg);
        }

        &.active {
            background: var(--accent);
            color: white;
        }
    }

    /* ==========================================================================
   Code View
   ========================================================================== */

    .code-view {
        font-size: var(--text-xs);
        line-height: var(--leading-relaxed);
        filter: saturate(0.9);

        @media (prefers-color-scheme: dark) {
            filter: saturate(0.9) brightness(1.05);
        }
    }

    .code-line {
        display: flex;
        min-height: 1.5em;

        &:hover {
            background: var(--hover-subtle);
        }

        &.highlighted {
            background: var(--yellow-dim);
        }

        &.selected {
            background: var(--accent-dim);
        }

        &.selected-impl {
            background: var(--highlight-impl);
        }

        &.selected-verify {
            background: var(--highlight-verify);
        }

        &.covered .line-number {
            border-inline-start-color: var(--green);
        }

        &.uncovered .line-number {
            border-inline-start-color: var(--red);
        }
    }

    .line-number {
        width: 4rem;
        padding: 0 var(--space-3) 0 var(--space-2);
        text-align: end;
        color: var(--fg-dim);
        user-select: none;
        flex-shrink: 0;
        cursor: pointer;
        position: relative;
        border-inline-start: 3px solid transparent;

        &:hover {
            color: var(--accent);
        }
    }

    .line-popover {
        position: absolute;
        inset-inline-start: 100%;
        top: 50%;
        transform: translateY(-50%);
        margin-inline-start: 0.5rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 100;
        white-space: nowrap;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .popover-btn {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
        color: var(--fg);
        text-decoration: none;
        font-size: var(--text-sm);

        &:hover {
            background: var(--hover);
        }

        & i {
            font-size: 1rem;
        }

        & .editor-icon-svg {
            width: 1rem;
            height: 1rem;
        }
    }

    .line-content {
        flex: 1;
        padding-inline-end: 1rem;
        white-space: pre;
    }

    .line-annotations {
        padding: 0 var(--space-2);
        display: flex;
        align-items: center;
        gap: var(--space-1);
        position: relative;

        &:hover {
            & .annotation-badges {
                display: flex;
            }

            & .annotation-count {
                display: none;
            }
        }
    }

    .annotation-count {
        font-size: var(--text-2xs);
        min-width: 1.2em;
        height: 1.2em;
        padding: 0 var(--space-1);
        border-radius: 3px;
        background: var(--accent-dim);
        color: var(--accent);
        font-weight: var(--weight-semibold);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    .annotation-badges {
        display: none;
        position: absolute;
        inset-inline-end: 0;
        top: 50%;
        transform: translateY(-50%);
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: var(--space-1);
        gap: var(--space-1);
        flex-wrap: wrap;
        max-width: 300px;
        z-index: 50;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .annotation-badge {
        font-size: var(--text-2xs);
        padding: var(--space-0-5) var(--space-1-5);
        border-radius: 3px;
        background: var(--accent-dim);
        color: var(--accent);
        font-weight: var(--ui-weight);
        white-space: nowrap;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.15s;

        &:is(a):hover {
            background: var(--accent);
            color: white;
        }
    }

    /* ==========================================================================
   Rules Table
   ========================================================================== */

    .rules-table {
        width: 100%;
        border-collapse: collapse;

        & th {
            text-align: start;
            padding: var(--space-3) var(--space-4);
            font-size: var(--label-size);
            font-weight: var(--label-weight);
            color: var(--fg-muted);
            text-transform: uppercase;
            letter-spacing: var(--label-tracking);
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        & td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        & tr:hover td {
            background: var(--hover-subtle);
        }
    }

    .rule-id {
        font-size: var(--text-sm);
        font-weight: var(--ui-weight);
        color: var(--accent);

        &-row {
            display: flex;
            align-items: flex-start;
            gap: var(--space-1-5);
        }
    }

    .rule-icon {
        width: 1em;
        height: 1em;
        color: var(--fg-dim);
        flex-shrink: 0;
    }

    .rule-text {
        font-size: var(--text-sm);
        color: var(--fg-muted);
        margin-top: 0.25rem;

        & code {
            font-size: var(--code-inline-size);
            background: var(--hover);
            padding: var(--space-0-5) var(--space-1);
            border-radius: 3px;
        }
    }

    .rule-refs {
        font-size: var(--text-sm);
    }

    .rule-ref {
        color: var(--fg-muted);
        text-decoration: none;
        padding: var(--space-0-5) 0;

        &:hover {
            color: var(--accent);
        }

        &.impl {
            color: var(--green);
        }

        &.verify {
            color: var(--accent);
        }
    }

    /* ==========================================================================
   Split View
   ========================================================================== */

    .split-view {
        display: flex;
        flex: 1;
        overflow: hidden;
    }

    .split-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        min-width: 0;

        & + & {
            border-inline-start: 1px solid var(--border);
        }

        &-header {
            padding: var(--space-2) var(--space-4);
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            font-size: var(--text-sm);
            font-weight: var(--ui-weight);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        &-content {
            flex: 1;
            overflow: auto;
        }
    }

    /* ==========================================================================
   Markdown Content
   ========================================================================== */

    .markdown {
        padding: var(--space-3) var(--space-8) var(--space-6) var(--space-8);
        font-size: var(--text-base);
        line-height: var(--leading-relaxed);
        max-width: 800px;
        hyphens: auto;

        & hr {
            border-style: solid;
            border-width: 0.5px;
            max-width: 100%;
            margin: var(--space-8) auto;
            opacity: 0.5;
        }

        & :is(h1, h2, h3, h4) {
            margin: var(--space-6) 0 var(--space-3);
            color: var(--fg-heading);
            cursor: pointer;

            &:hover {
                color: var(--accent);
            }

            &:target {
                color: var(--accent);
                background: var(--highlight-target);
                margin-inline-start: calc(-1 * var(--space-2));
                margin-inline-end: calc(-1 * var(--space-2));
                padding: var(--space-1) var(--space-2);
                border-radius: 4px;
            }
        }

        & :is(h1, h2) {
            margin-top: var(--space-10);

            &:first-child {
                margin-top: 0;
            }
        }

        & h1 {
            font-size: var(--heading-1-size);
            font-weight: var(--heading-1-weight);
        }

        & h2 {
            font-size: var(--heading-2-size);
            font-weight: var(--heading-2-weight);
        }

        & h3 {
            font-size: var(--heading-3-size);
            font-weight: var(--heading-3-weight);
        }

        & h4 {
            font-weight: var(--heading-4-weight);
        }

        & p {
            margin: var(--space-4) 0;
            position: relative;

            &:hover > .para-edit-btn {
                opacity: 1;
            }
        }

        & a {
            color: var(--accent);
            text-decoration: none;

            &:hover {
                text-decoration: underline;
            }
        }

        & code {
            background: var(--fg-15);
            padding: var(--space-0-5) var(--space-1);
            border-radius: 4px;
            font-size: var(--code-inline-size);
            color: var(--fg-heading);
        }

        & pre {
            background: var(--bg-secondary-95);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: var(--space-2-5) var(--space-3);
            overflow-x: auto;
            margin: var(--space-4) 0;
            line-height: var(--leading-snug);
            filter: saturate(0.9);

            @media (prefers-color-scheme: dark) {
                filter: saturate(0.9) brightness(1.05);

                & .comment,
                & [class*="comment"] {
                    opacity: 0.6;
                }
            }

            & code {
                background: none;
                padding: 0;
            }
        }

        & :is(ul, ol) {
            margin: var(--space-3) 0;
            padding-inline-start: var(--space-6);
        }

        & li {
            margin: var(--space-1) 0;
            position: relative;

            &:hover > .para-edit-btn {
                opacity: 1;
            }
        }

        & blockquote {
            border-inline-start: 3px solid var(--accent);
            margin: var(--space-4) 0;
            padding: var(--space-3) var(--space-4);
            background: var(--hover-subtle);
            border-radius: 0 0.25rem 0.25rem 0;
            color: var(--fg);
            position: relative;

            &:hover > .para-edit-btn {
                opacity: 1;
            }
        }

        & table {
            width: 100%;
            border-collapse: collapse;
            margin: var(--space-4) 0;
            font-size: var(--text-sm);
        }

        & :is(th, td) {
            padding: var(--space-2-5) var(--space-3);
            text-align: start;
            border: none;
        }

        & thead {
            border-bottom: 1px solid var(--border-strong);
        }

        & th {
            background: transparent;
            font-weight: var(--weight-semibold);
            color: var(--fg-heading);
        }

        & td {
            background: transparent;
            font-weight: var(--weight-normal);

            & code {
                font-size: var(--code-inline-size);
            }
        }

        & tbody tr:nth-child(odd) {
            background: var(--hover-subtle);
        }

        & tr:hover td {
            background: var(--hover);
        }
    }

    /* ==========================================================================
   RFC 2119 Keywords
   ========================================================================== */

    :is(kw-must, kw-must-not, kw-required, kw-shall, kw-shall-not) {
        color: var(--red);
        font-weight: var(--weight-semibold);
    }

    :is(kw-should, kw-should-not, kw-recommended, kw-not-recommended) {
        color: var(--yellow);
        font-weight: var(--weight-semibold);
    }

    :is(kw-may, kw-optional) {
        color: var(--accent);
        font-weight: var(--weight-semibold);
    }

    /* ==========================================================================
   Rule Marker
   ========================================================================== */

    .rule-marker {
        display: inline-flex;
        align-items: center;
        gap: var(--space-1);
        width: fit-content;
        background: var(--accent-dim);
        color: var(--accent);
        font-size: var(--text-xs);
        padding: var(--space-0-5) var(--space-1-5);
        border-radius: 3px;
        margin: var(--space-0-5) 0;
        text-decoration: none;

        &:is(a):hover {
            filter: brightness(1.1);
        }

        &-icon {
            width: 0.9em;
            height: 0.9em;
            flex-shrink: 0;
        }

        &.covered {
            background: var(--status-covered-bg);
            color: var(--status-covered-fg);
        }

        &.partial {
            background: var(--status-partial-bg);
            color: var(--status-partial-fg);
        }

        &.uncovered {
            background: var(--status-none-bg);
            color: var(--status-none-fg);
        }

        &-highlighted {
            animation: pulse-attention var(--duration-emphasis) var(--ease-out);
        }
    }

    /* ==========================================================================
   Rule Block
   ========================================================================== */

    .rule-block {
        position: relative;
        border: 1px solid var(--border);
        border-radius: 6px;
        margin: var(--space-6) 0;
        padding: var(--space-5) var(--space-4) var(--space-2) var(--space-4);
        font-size: var(--text-sm);

        & + & {
            margin-top: var(--space-4);
        }

        &-covered {
            border-color: var(--rule-covered-border);
        }

        &-partial {
            border-color: var(--rule-partial-border);
        }

        &-uncovered {
            border-color: var(--rule-uncovered-border);
        }

        &-header {
            position: absolute;
            top: -0.65rem;
            inset-inline-start: var(--space-3);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            background: var(--bg);
            padding: 0 var(--space-1-5);

            & .rule-marker {
                margin: 0;
            }

            & .spec-refs {
                margin: 0;
                font-size: var(--text-sm);
            }
        }

        &-content {
            margin-top: var(--space-1);

            & p:first-child {
                margin-top: 0;
            }

            & p:last-child {
                margin-bottom: 0;
            }
        }
    }

    /* ==========================================================================
   Requirement Container
   ========================================================================== */

    .req-container {
        position: relative;
        border: 1px solid var(--border);
        border-radius: 6px;
        margin: var(--space-8) 0;
        padding: var(--space-6) var(--space-5) var(--space-5) var(--space-5);
        font-size: var(--text-sm);

        /* Default (uncovered) badge colors */
        --req-badge-bg: var(--status-uncovered-bg);
        --req-badge-color: var(--status-uncovered-fg);
        --req-badge-weight: 700;

        &::before {
            content: "";
            position: absolute;
            inset-inline-start: 0;
            top: 1.75rem;
            bottom: 1.25rem;
            width: 3px;
            background: var(--neutral);
            border-radius: 0 2px 2px 0;
        }

        & + & {
            margin-top: var(--space-6);
        }

        &.req-covered {
            border-color: var(--border);
            opacity: 0.5;
            --req-badge-bg: var(--status-covered-bg);
            --req-badge-color: var(--status-covered-fg);
            --req-badge-weight: 500;

            &:hover {
                opacity: 0.8;
            }

            &::before {
                background: var(--green);
                opacity: 0.5;
            }
        }

        &.req-partial {
            border-color: var(--yellow-50);
            --req-badge-bg: var(--status-partial-bg);
            --req-badge-color: var(--status-partial-fg);
            --req-badge-weight: 500;

            &::before {
                background: var(--yellow);
            }
        }

        &.req-uncovered {
            border: 2px dashed var(--accent);
            background: var(--accent-5);

            &::before {
                display: none;
            }
        }

        &.req-focused {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px var(--focus-ring);
        }

        &.req-copy-success {
            animation: flash-success var(--duration-normal) var(--ease-out);
        }
    }

    .req-badges-left,
    .req-badges-right {
        position: absolute;
        top: -0.7rem;
        display: flex;
        align-items: center;
        gap: var(--space-1);
        background: var(--bg);
        padding: 0 var(--space-1);
    }

    .req-badges-left {
        inset-inline-start: var(--space-3);
    }

    .req-badges-right {
        inset-inline-end: var(--space-4);
    }

    .req-badge {
        font-size: var(--text-xs);
        padding: var(--space-0-5) var(--space-2);
        border-radius: 4px;
        text-decoration: none;
        font-weight: var(--weight-semibold);
        transition: filter 0.15s;
        letter-spacing: var(--tracking-wide);
        font-family: var(--font-mono);
        font-variation-settings:
            "MONO" 1,
            "CASL" 0;

        &:hover {
            filter: brightness(1.15);
        }

        &.req-id {
            background: var(--req-badge-bg);
            color: var(--req-badge-color);
            font-weight: var(--req-badge-weight);
        }

        &.req-impl {
            background: var(--ref-impl-bg);
            color: var(--ref-impl-color);
            border: 1px solid var(--ref-impl-border);
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: var(--space-1);
        }

        &.req-test {
            background: var(--ref-verify-bg);
            color: var(--ref-verify-color);
            border: 1px solid var(--ref-verify-border);
        }

        &.req-edit {
            background: var(--fg-8);
            color: var(--fg-muted);
            border: 1px solid var(--fg-20);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            transition: all 0.15s;

            &:hover {
                background: var(--accent-12);
                color: var(--accent);
                border-color: var(--accent-30);
            }
        }

        &.req-copy {
            background: var(--req-badge-bg);
            color: var(--req-badge-color);
            border: none;
            cursor: pointer;
            font-family: inherit;
            padding: var(--space-0-5) var(--space-1-5);
            min-width: 1.8rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;

            &:hover {
                filter: brightness(1.2);
            }

            &.req-copy-success {
                filter: brightness(1.3);
            }
        }
    }

    .req-edit-icon,
    .req-copy-icon {
        flex-shrink: 0;
    }

    .req-badge-group {
        display: inline-flex;
        gap: var(--space-1);
    }

    .req-segment-left {
        border-radius: 4px 0 0 4px;
    }

    .req-segment-right {
        border-radius: 0 4px 4px 0;
    }

    .req-content {
        margin-top: var(--space-1);

        & p {
            margin: var(--space-2) 0;
        }

        & > *:last-child {
            margin-bottom: 0;
        }

        & :is(ol, ul) {
            margin: var(--space-3) 0;
            padding-inline-start: var(--space-6);
        }

        & li {
            margin: var(--space-1-5) 0;
            padding-inline-start: var(--space-2);
            line-height: var(--leading-loose);

            & :is(strong, em):first-child {
                color: var(--fg-muted);
                font-style: normal;
                font-weight: var(--weight-semibold);
                font-size: var(--code-inline-size);
                text-transform: uppercase;
                letter-spacing: var(--tracking-wider);
                margin-inline-end: 0.25em;
            }
        }
    }

    /* ==========================================================================
   Vim Pending Key Indicator
   ========================================================================== */

    .vim-pending-key {
        position: fixed;
        bottom: var(--space-4);
        inset-inline-end: var(--space-4);
        background: var(--bg-secondary);
        border: 1px solid var(--accent);
        color: var(--accent);
        padding: var(--space-2) var(--space-4);
        border-radius: 6px;
        font-family: var(--font-mono);
        font-size: var(--text-xl);
        font-weight: var(--weight-bold);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        animation: pop-in var(--duration-instant) var(--ease-spring);
    }

    /* ==========================================================================
   Spec References
   ========================================================================== */

    .spec-refs {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-1-5);
        margin: var(--space-1) 0 var(--space-2) 0;
        font-size: var(--text-sm);
    }

    .spec-ref {
        text-decoration: none;
        padding: var(--space-0-5) var(--space-1-5);
        border-radius: 3px;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        display: inline-flex;
        align-items: center;
        gap: var(--space-1);

        &:hover {
            border-color: var(--accent);
        }

        &-icon {
            width: 0.9em;
            height: 0.9em;
            flex-shrink: 0;
        }

        &-impl {
            color: var(--green);
        }

        &-verify {
            color: var(--accent);
        }
    }

    /* Reference type icon colors */
    :is(.spec-ref-icon-impl, .ref-icon-impl, .file-path-icon-impl) {
        color: var(--ref-impl-color);
    }

    :is(.spec-ref-icon-verify, .ref-icon-verify, .file-path-icon-verify) {
        color: var(--ref-verify-color);
    }

    /* ==========================================================================
   References Popup
   ========================================================================== */

    .refs-popup {
        position: fixed;
        z-index: 10000;

        &-inner {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            min-width: 200px;
            max-width: 400px;
        }

        &-item {
            padding: var(--space-2) var(--space-3);
            cursor: pointer;
            transition: background 0.15s;
            font-size: var(--text-sm);

            &:hover {
                background: var(--hover);
            }

            & + & {
                border-top: 1px solid var(--border);
            }
        }

        &-file {
            color: var(--fg);
        }
    }

    /* ==========================================================================
   Empty State
   ========================================================================== */

    .empty-state {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--fg-muted);
        font-size: var(--text-sm);
    }

    /* ==========================================================================
   Custom Dropdown
   ========================================================================== */

    .custom-dropdown {
        position: relative;
        display: inline-block;

        &.open .dropdown-menu {
            display: block;
        }
    }

    .dropdown-selected {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-1-5) var(--space-2-5);
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 6px;
        cursor: pointer;
        font-family: inherit;
        font-size: var(--text-sm);
        color: var(--fg);
        min-width: 90px;

        &:hover {
            background: var(--hover);
        }

        & svg {
            width: 1rem;
            height: 1rem;
            flex-shrink: 0;

            & path {
                fill: currentColor;
            }
        }

        & .chevron {
            margin-inline-start: auto;
            opacity: 0.5;

            & path {
                fill: none;
                stroke: currentColor;
            }
        }
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        inset-inline-start: 0;
        margin-top: 4px;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 100;
        min-width: 100%;
        display: none;
    }

    .dropdown-option {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
        cursor: pointer;
        font-family: inherit;
        font-size: var(--text-sm);
        color: var(--fg-muted);
        white-space: nowrap;

        &:first-child {
            border-radius: 5px 5px 0 0;
        }

        &:last-child {
            border-radius: 0 0 5px 5px;
        }

        &:hover {
            background: var(--hover);
        }

        &.active {
            background: var(--hover);
            color: var(--fg);
        }

        & svg {
            width: 1rem;
            height: 1rem;
            flex-shrink: 0;

            & path {
                fill: currentColor;
            }
        }
    }

    /* ==========================================================================
   Level Dots
   ========================================================================== */

    .level-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;

        &-all {
            background: var(--fg-muted);
        }
        &-must {
            background: var(--red);
        }
        &-should {
            background: var(--yellow);
        }
        &-may {
            background: var(--accent);
        }
    }

    /* ==========================================================================
   File References
   ========================================================================== */

    .ref-line {
        white-space: nowrap;
        margin-bottom: var(--space-1-5);
        display: flex;
        align-items: center;
        gap: var(--space-1-5);

        &:last-child {
            margin-bottom: 0;
        }
    }

    .ref-icon {
        width: 1.1em;
        height: 1.1em;
        flex-shrink: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;

        & svg {
            width: 100%;
            height: 100%;
        }
    }

    /* ==========================================================================
   File Path Component
   ========================================================================== */

    .file-path-link,
    .file-path-display {
        display: inline-flex;
        align-items: center;
        gap: var(--space-1-5);
        text-decoration: none;
        font-size: 0.95em;
    }

    .file-path-link:hover .file-path-name {
        text-decoration: underline;
    }

    .file-path-icon {
        width: 1em;
        height: 1em;
        flex-shrink: 0;
        color: var(--fg-muted);
    }

    .file-path-text {
        display: inline;
    }
    .file-path-dir {
        color: var(--fg-dim);
    }
    .file-path-name {
        color: var(--accent);
    }
    .file-path-line {
        color: var(--green);
    }

    /* Legacy file-link (backwards compat) */
    .file-link {
        text-decoration: none;
        display: inline-flex;

        &:hover .file-name {
            text-decoration: underline;
        }
    }

    .file-path {
        color: var(--fg-dim);
    }
    .file-name {
        color: var(--accent);
    }
    .file-line {
        color: var(--green);
    }

    /* ==========================================================================
   Outline Tree (TOC)
   ========================================================================== */

    .outline-tree {
        padding: var(--space-2);
        padding-bottom: var(--space-12);
        margin: 0;
        list-style: none;
    }

    .toc-item {
        list-style: none;

        &.depth-1 > .toc-row .toc-link {
            color: var(--fg);
            font-weight: var(--ui-weight);
        }

        &.is-complete > .toc-row {
            & .toc-link {
                color: var(--fg-dim);
                opacity: 0.7;
            }

            & .toc-badges {
                opacity: 0.5;
            }
        }

        &.is-incomplete > .toc-row {
            & .toc-link {
                color: var(--fg-muted);
            }

            & .toc-badges {
                opacity: 1;
            }
        }

        &.is-active > .toc-row {
            background: var(--accent-12);

            & .toc-link {
                font-weight: var(--weight-semibold);
                color: var(--accent);
            }

            & .toc-badges {
                opacity: 1;
            }
        }
    }

    .toc-row {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-1) var(--space-2);
        border-radius: 6px;
        text-decoration: none;
        color: inherit;

        &:hover {
            background: var(--hover);

            & .toc-link {
                color: var(--fg);
            }
        }
    }

    .toc-link {
        flex: 1;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: var(--fg-muted);
        text-decoration: none;
        font-size: var(--text-sm);
    }

    .toc-badges {
        display: flex;
        align-items: center;
        gap: var(--space-1);
        flex: 0 0 auto;
        margin-inline-start: auto;
        opacity: 0.5;
    }

    .toc-children {
        margin: 0;
        padding: 0;
        padding-inline-start: var(--space-3);
        margin-inline-start: var(--space-2);
        border-inline-start: 1px solid var(--border-strong);
        list-style: none;

        &.has-active {
            border-inline-start-color: var(--accent);
        }
    }

    /* ==========================================================================
   Outline Legend
   ========================================================================== */

    .outline-legend {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        font-size: var(--text-2xs);
        font-weight: var(--weight-normal);
        color: var(--fg-dim);
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: var(--space-1);
    }

    .legend-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;

        &--impl {
            background: var(--green);
        }
        &--test {
            background: var(--blue);
        }
    }

    /* ==========================================================================
   Paragraph Edit Button
   ========================================================================== */

    .para-edit-btn {
        position: absolute;
        inset-inline-end: -1.5rem;
        top: 0.15rem;
        width: 1.25rem;
        height: 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 0.25rem;
        color: var(--fg-dim);
        cursor: pointer;
        opacity: 0;
        transition:
            opacity 0.15s,
            color 0.15s,
            background 0.15s;
        text-decoration: none;

        &:hover {
            background: var(--hover);
            color: var(--accent);
            border-color: var(--accent);
        }

        & svg {
            width: 0.75rem;
            height: 0.75rem;
        }
    }

    /* ==========================================================================
   Search Results
   ========================================================================== */

    .search-results {
        flex: 1;
        overflow-y: auto;
        background: var(--bg);
    }

    .search-result {
        padding: var(--space-2) var(--space-4);
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        font-size: var(--text-sm);

        &:hover {
            background: var(--hover);
        }

        &-file {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            margin-bottom: var(--space-1);
        }

        &-path {
            color: var(--fg-dim);
        }
        &-name {
            color: var(--accent);
        }
        &-line {
            color: var(--green);
        }

        &-content {
            color: var(--fg-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        &-highlight {
            background: var(--yellow-dim);
            color: var(--yellow);
            padding: var(--space-0-5) var(--space-1);
            border-radius: 2px;
        }

        &-icon {
            width: 1.1rem;
            height: 1.1rem;
            flex-shrink: 0;

            &.source {
                color: var(--green);
            }
            &.rule {
                color: var(--accent);
            }
        }
    }

    .search-empty {
        padding: var(--space-8);
        text-align: center;
        color: var(--fg-muted);
    }

    .search-loading {
        padding: var(--space-4);
        text-align: center;
        color: var(--fg-muted);
        font-size: var(--text-sm);
    }

    /* ==========================================================================
   Rule Context Panel
   ========================================================================== */

    .rule-context {
        border: 1px solid var(--border);
        border-radius: 6px;
        margin: var(--space-2);
        background: var(--bg);

        &-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-2) var(--space-3);
            background: var(--accent-dim);
            border-radius: 5px 5px 0 0;
            border-bottom: 1px solid var(--border);
        }

        &-id {
            font-size: var(--text-sm);
            font-weight: var(--ui-weight);
            color: var(--accent);
        }

        &-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--fg-muted);
            padding: var(--space-1);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;

            &:hover {
                background: var(--hover);
                color: var(--fg);
            }
        }

        &-body {
            padding: var(--space-3);
        }

        &-text {
            font-size: var(--text-sm);
            color: var(--fg-muted);
            margin-bottom: var(--space-3);
            line-height: var(--leading-normal);
        }

        &-refs {
            display: flex;
            flex-direction: column;
            gap: var(--space-1-5);
        }

        &-ref {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-1-5) var(--space-2);
            border-radius: 4px;
            font-size: var(--text-sm);
            cursor: pointer;
            text-decoration: none;
            color: var(--fg);

            &:hover {
                background: var(--hover);
            }

            &.active {
                background: var(--accent-dim);
            }
        }

        &-back {
            display: flex;
            align-items: center;
            gap: var(--space-1-5);
            margin-top: var(--space-3);
            padding: var(--space-1-5) var(--space-2);
            border-radius: 4px;
            font-size: var(--text-sm);
            cursor: pointer;
            color: var(--fg-muted);
            text-decoration: none;

            &:hover {
                background: var(--hover);
                color: var(--fg);
            }
        }
    }

    /* ==========================================================================
   Search Overlay / Modal
   ========================================================================== */

    .search-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding-top: 10vh;
        z-index: 1000;
    }

    .search-modal {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        width: 600px;
        max-width: 90vw;
        max-height: 70vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);

        &-input {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border);

            & input {
                width: 100%;
                padding: var(--space-3) var(--space-4);
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                font-size: var(--text-base);
                color: var(--fg);
                font-family: inherit;

                &:focus {
                    outline: none;
                    border-color: var(--accent);
                    box-shadow: 0 0 0 3px var(--accent-dim);
                }
            }
        }

        &-results {
            flex: 1;
            overflow-y: auto;
        }

        &-result {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--border);
            cursor: pointer;

            &:hover {
                background: var(--hover);
            }

            &.selected {
                background: var(--accent-dim);
            }

            &-header {
                display: flex;
                align-items: center;
                gap: var(--space-2);
                margin-bottom: var(--space-1);
            }

            &-id {
                font-size: var(--text-sm);
                color: var(--accent);
            }

            &-line {
                color: var(--green);
                font-size: var(--text-sm);
            }

            &-content {
                font-size: var(--text-sm);
                color: var(--fg-muted);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;

                & mark {
                    background: var(--yellow-dim);
                    color: var(--yellow);
                    padding: 0.1em 0.2em;
                    border-radius: 2px;
                }
            }

            &-code {
                font-size: var(--text-xs);
                line-height: var(--leading-relaxed);
                margin: 0;
                padding: var(--space-1) 0;
                background: transparent;
                white-space: pre;
                overflow: hidden;
                text-overflow: ellipsis;
                color: var(--fg-muted);

                & code {
                    background: none;
                    padding: 0;
                }

                & mark {
                    background: var(--yellow-dim);
                    color: var(--yellow);
                    padding: 0.1em 0.2em;
                    border-radius: 2px;
                }
            }
        }

        &-empty {
            padding: var(--space-8);
            text-align: center;
            color: var(--fg-muted);
        }

        &-hint {
            padding: var(--space-3) var(--space-4);
            border-top: 1px solid var(--border);
            font-size: var(--text-xs);
            color: var(--fg-dim);
            display: flex;
            gap: var(--space-4);

            & kbd {
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 3px;
                padding: var(--space-0-5) var(--space-1-5);
                font-size: var(--text-2xs);
            }
        }
    }

    /* ==========================================================================
   Modal Overlay
   ========================================================================== */

    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: var(--space-8);
    }

    .modal-content {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        width: 900px;
        max-width: 100%;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);

        &.editor-modal {
            width: 1200px;
        }
    }

    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-4) var(--space-6);
        border-bottom: 1px solid var(--border);

        & h3 {
            margin: 0;
            font-size: var(--text-lg);
            font-weight: var(--weight-semibold);
            color: var(--fg);
        }
    }

    .modal-vim-indicator {
        font-size: var(--text-2xs);
        padding: var(--space-1) var(--space-2);
        background: var(--green-dim);
        color: var(--green);
        border-radius: 3px;
        font-weight: var(--weight-semibold);
        letter-spacing: var(--label-tracking);
        margin-inline-start: auto;
        margin-inline-end: var(--space-2);
    }

    .modal-close {
        background: none;
        border: none;
        font-size: var(--text-2xl);
        color: var(--fg-muted);
        cursor: pointer;
        padding: 0;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: all 0.15s;

        &:hover {
            background: var(--hover);
            color: var(--fg);
        }
    }

    .modal-body {
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 400px;
    }

    .impl-preview-modal {
        & .modal-body {
            overflow-y: auto;
            overflow-x: hidden;
        }

        & .code-preview {
            font-size: var(--text-sm);
            line-height: var(--leading-normal);
            white-space: pre;
            overflow-x: auto;

            & .highlight-line {
                background: var(--highlight-accent);
            }
        }
    }

    .modal-loading,
    .modal-error {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--fg-muted);
        font-size: var(--text-sm);
    }

    .modal-error {
        color: var(--red);
    }

    .markdown-editor-wrapper {
        flex: 1;
        background: var(--bg);
        overflow: hidden;

        & .cm-editor {
            height: 100%;
        }
    }

    .modal-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-4) var(--space-6);
        border-top: 1px solid var(--border);
        gap: var(--space-4);
    }

    .modal-info {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        font-size: var(--text-sm);
        color: var(--fg-muted);
        flex: 1;
        min-width: 0;

        & code {
            background: var(--bg);
            padding: var(--space-1) var(--space-1-5);
            border-radius: 3px;
            font-size: var(--text-xs);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    }

    .modal-range {
        color: var(--fg-dim);
        font-family: var(--font-mono);
        font-size: var(--text-xs);
    }

    .modal-actions {
        display: flex;
        gap: var(--space-3);
    }

    .modal-btn {
        padding: var(--space-2) var(--space-4);
        border-radius: 6px;
        border: 1px solid var(--border);
        font-family: inherit;
        font-size: var(--text-sm);
        cursor: pointer;
        transition: all 0.15s;

        &:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        &-cancel {
            background: var(--bg);
            color: var(--fg);

            &:hover:not(:disabled) {
                background: var(--hover);
            }
        }

        &-save {
            background: var(--accent);
            color: white;
            border-color: var(--accent);

            &:hover:not(:disabled) {
                filter: brightness(1.1);
            }
        }

        &-primary {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
            font-weight: var(--ui-weight);

            &:hover:not(:disabled) {
                filter: brightness(0.95);
            }
        }
    }

    /* ==========================================================================
   Inline Editor
   ========================================================================== */

    .inline-editor {
        border: 2px solid var(--accent);
        border-radius: 6px;
        background: var(--bg-secondary);
        margin: var(--space-4) 0;
        overflow: hidden;

        &-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) var(--space-3);
            background: var(--accent-dim);
            border-bottom: 1px solid var(--border);
            font-size: var(--text-sm);
        }

        &-label {
            font-weight: var(--weight-semibold);
            color: var(--accent);
        }

        &-vim {
            font-size: var(--text-2xs);
            padding: var(--space-0-5) var(--space-1-5);
            background: var(--green-dim);
            color: var(--green);
            border-radius: 3px;
            font-weight: var(--weight-semibold);
            letter-spacing: var(--label-tracking);
        }

        &-path {
            color: var(--fg-dim);
            font-family: var(--font-mono);
            font-size: var(--text-xs);
            margin-inline-start: auto;
        }

        &-content {
            min-height: 400px;
            max-height: 600px;
            overflow: auto;
            background: var(--bg);
        }

        &-code {
            height: 100%;
            background: var(--bg);

            & .cm-editor {
                height: 100%;
            }
        }

        &-preview {
            padding: var(--space-6);
            background: var(--bg);
            min-height: 400px;
        }

        &-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-2);
            padding: var(--space-3);
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        &-btn {
            padding: var(--space-1-5) var(--space-3);
            border-radius: 4px;
            border: 1px solid var(--border);
            font-family: inherit;
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all 0.15s;

            &:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
        }

        &-cancel {
            background: var(--bg);
            color: var(--fg);

            &:hover:not(:disabled) {
                background: var(--hover);
            }
        }

        &-save {
            background: var(--accent);
            color: white;
            border-color: var(--accent);

            &:hover:not(:disabled) {
                filter: brightness(1.1);
            }
        }

        &-loading,
        &-error {
            padding: var(--space-4);
            text-align: center;
            color: var(--fg-muted);
            font-size: var(--text-sm);
        }

        &-error {
            color: var(--red);
        }
    }

    /* Config Error Banner */
    .config-error-banner {
        background: var(--red-20);
        border-bottom: 1px solid var(--red-30);
        padding: var(--space-2) var(--space-4);
        color: var(--fg);

        &-inner {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            max-width: 1400px;
            margin: 0 auto;
        }

        .config-error-icon {
            color: var(--red);
            flex-shrink: 0;
        }

        .config-error-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex: 1;

            strong {
                color: var(--fg-heading);
            }
        }

        .config-error-toggle {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: var(--text-sm);
            padding: 0;
            text-decoration: underline;

            &:hover {
                color: var(--fg-heading);
            }
        }

        .config-error-details {
            margin: var(--space-2) 0 0 0;
            padding: var(--space-3);
            background: var(--bg-secondary);
            border-radius: 4px;
            font-size: var(--text-sm);
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
    }
} /* end @layer components */
